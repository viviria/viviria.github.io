window.__require=function t(e,n,i){function o(c,a){if(!n[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var h="function"==typeof __require&&__require;if(!a&&h)return h(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}}var d=n[c]={exports:{}};e[c][0].call(d.exports,function(t){return o(e[c][1][t]||t)},d,d.exports,t,e,n,i)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({main:[function(t,e,n){"use strict";cc._RF.push(e,"13201ArYMZBvLvxXK160b4h","main");var i=cc.Enum({FLOOR:0,WALL:1,ITEM:2,ENEMY:3,STAIRS:4});cc.Class({extends:cc.Component,properties:{floorPrefab:{type:cc.Prefab,default:null},wallPrefab:{type:cc.Prefab,default:null},enemyPrefab:{type:cc.Prefab,default:null},itemPrefab:{type:cc.Prefab,default:null},stairsPrefab:{type:cc.Prefab,default:null},_isTouch:!1},onTapChangeMoveMode:function(){var t=this;this.node.targetOff(this);var e=null,n=this.node.getChildByName("map");this.node.on(cc.Node.EventType.TOUCH_START,function(n){t._isTouch=!0,e=n.getLocation()},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(i){if(t._isTouch&&e){var o=i.getLocation();n.position=n.position.add(o.sub(e)),e=o}},this);var i=function(n){t._isTouch=!1,e=null};this.node.on(cc.Node.EventType.TOUCH_END,i,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,i,this)},onTapMoveReset:function(){this.node.targetOff(this),this.node.getChildByName("map").position=cc.v2(0,0)},getNearlyPosition:function(t,e){var n=t.x%e,i=t.y%e,o=(Math.trunc(t.x/e)+(n>=e/2?1:n<-e/2?-1:0))*e,r=(Math.trunc(t.y/e)+(i>=e/2?1:i<-e/2?-1:0))*e;return new cc.Vec2(o,r)},isAlreadyPutObject:function(t,e){for(var n=this.node.getChildByName("map").getChildren().filter(function(t){return t.type==e}),i=0;i<n.length;i++)if(n[i].x==t.x&&n[i].y==t.y)return!0;return!1},generateFloor:function(t){var e=this.node.getChildByName("map"),n=this.getNearlyPosition(e.convertToNodeSpace(t),50);if(!this.isAlreadyPutObject(n,i.FLOOR)){var o=cc.instantiate(this.floorPrefab);o.type=i.FLOOR,o.position=n,e.addChild(o)}},onTapChangeFloorMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t._isTouch=!0,t.generateFloor(e.getLocation())},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t._isTouch&&t.generateFloor(e.getLocation())},this);var e=function(e){t._isTouch=!1};this.node.on(cc.Node.EventType.TOUCH_END,e,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,e,this)},getfloor:function(t){for(var e=this.node.getChildByName("map").getChildren().filter(function(t){return t.type==i.FLOOR}),n=0;n<e.length;n++)if(e[n].x==t.x&&e[n].y==t.y)return e[n];return null},getWallPositionAndAngle:function(t,e){var n=180*Math.atan2(t.x-e.x,t.y-e.y)/Math.PI,i=cc.v2(0,0),o=0;return n>-45&&n<=45?(i=cc.v2(0,25),o=0):n>45&&n<=135?(i=cc.v2(25,0),o=-90):n>-135&&n<=-45?(i=cc.v2(-25,0),o=90):(i=cc.v2(0,-25),o=180),{position:e.add(i),angle:o}},generateWall:function(t){var e=this.node.getChildByName("map"),n=e.convertToNodeSpace(t),o=this.getNearlyPosition(n,50);if(this.getfloor(o)){var r=this.getWallPositionAndAngle(n,o);if(!this.isAlreadyPutObject(r.position,i.WALL)){var c=cc.instantiate(this.wallPrefab);c.type=i.WALL,c.position=r.position,c.angle=r.angle,e.addChild(c)}}},onTapChangeWallMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t._isTouch=!0,t.generateWall(e.getLocation())},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t._isTouch&&t.generateWall(e.getLocation())},this);var e=function(e){t._isTouch=!1};this.node.on(cc.Node.EventType.TOUCH_END,e,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,e,this)},isAlreadyPutEnemy:function(t){return t.getChildren().filter(function(t){return t.type==i.ENEMY}).length>0},generateEnemy:function(t){var e=this.node.getChildByName("map").convertToNodeSpace(t),n=this.getNearlyPosition(e,50),o=this.getfloor(n);if(o&&!this.isAlreadyPutEnemy(o)&&!this.isAlreadyPutStairs(o)){var r=cc.instantiate(this.enemyPrefab);r.type=i.ENEMY,r.position=cc.v2(0,0),this.isAlreadyPutItem(o)&&r.setContentSize(10,10),o.addChild(r)}},onTapChangeEnemyMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t._isTouch=!0,t.generateEnemy(e.getLocation())},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t._isTouch&&t.generateEnemy(e.getLocation())},this);var e=function(e){t._isTouch=!1};this.node.on(cc.Node.EventType.TOUCH_END,e,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,e,this)},isAlreadyPutItem:function(t){return t.getChildren().filter(function(t){return t.type==i.ITEM}).length>0},generateItem:function(t){var e=this.node.getChildByName("map").convertToNodeSpace(t),n=this.getNearlyPosition(e,50),o=this.getfloor(n);if(o&&!this.isAlreadyPutItem(o)&&!this.isAlreadyPutStairs(o)){var r=cc.instantiate(this.itemPrefab);r.type=i.ITEM,r.position=cc.v2(0,0),this.isAlreadyPutEnemy(o)&&r.setContentSize(10,10),o.addChild(r)}},onTapChangeItemMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t._isTouch=!0,t.generateItem(e.getLocation())},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t._isTouch&&t.generateItem(e.getLocation())},this);var e=function(e){t._isTouch=!1};this.node.on(cc.Node.EventType.TOUCH_END,e,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,e,this)},isAlreadyPutStairs:function(t){return t.getChildren().filter(function(t){return t.type==i.STAIRS}).length>0},generateStairs:function(t){var e=this.node.getChildByName("map").convertToNodeSpace(t),n=this.getNearlyPosition(e,50),o=this.getfloor(n);if(o&&!(this.isAlreadyPutStairs(o)||this.isAlreadyPutItem(o)||this.isAlreadyPutEnemy(o))){var r=cc.instantiate(this.stairsPrefab);r.type=i.STAIRS,r.position=cc.v2(0,0),o.addChild(r)}},onTapChangeStairsMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t._isTouch=!0,t.generateStairs(e.getLocation())},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t._isTouch&&t.generateStairs(e.getLocation())},this);var e=function(e){t._isTouch=!1};this.node.on(cc.Node.EventType.TOUCH_END,e,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,e,this)},getHitWall:function(t){for(var e=this.node.getChildByName("map").getChildren().filter(function(t){return t.type==i.WALL}),n=0;n<e.length;n++){var o=e[n].getComponent(cc.BoxCollider).world.points;if(cc.log(t),cc.log(o),cc.Intersection.pointInPolygon(t,o))return e[n]}return null},removeObject:function(t){var e=this.getHitWall(t);if(e)e.removeFromParent();else{var n=this.node.getChildByName("map").convertToNodeSpace(t),i=this.getNearlyPosition(n,50),o=this.getfloor(i);if(o){var r=o.getChildren().reverse();if(r.length>0)return void r[0].removeFromParent();o.removeFromParent()}}},onTapChangeRemoveMode:function(){var t=this;this.node.targetOff(this),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.removeObject(e.getLocation())},this)},onLoad:function(){cc.director.getCollisionManager().enabled=!0},start:function(){this._isTouch=!1},update:function(t){}}),cc._RF.pop()},{}]},{},["main"]);